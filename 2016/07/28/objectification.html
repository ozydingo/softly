<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>objectification</title>
  <meta name="description" content="Object Over-Orientation">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="speaksoftly.io/2016/07/28/objectification.html">
  <link rel="alternate" type="application/rss+xml" title="Speak Softly" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">Speak Softly</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">objectification</h1>
    <p class="post-meta"><time datetime="2016-07-28T14:26:02-04:00" itemprop="datePublished">Jul 28, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="object-over-orientation">Object Over-Orientation</h2>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Hash</span>
  <span class="k">def</span> <span class="nf">transcript_sort</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">sort</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">|</span> <span class="n">a</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">to_i</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">to_i</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>What is this method doing? As its name correctly implies, its intended usage was to sort a transcript: specifically, a timed text transcript represented as a Hash with timestamps in the keys and words in the values.</p>

<p>So what’s it doing on <code class="highlighter-rouge">Hash</code>?</p>

<p>Ignoring that it effectively does the same thing as the built-in Ruby <a href="http://ruby-doc.org/core-1.8.7/Hash.html#method-i-sort"><code class="highlighter-rouge">Hash#sort</code></a> (&lt;2.0) or the equivalent method from <a href="http://ruby-doc.org/core-2.2.2/Enumerable.html#method-i-sort"><code class="highlighter-rouge">Enumerable</code></a> call edon <code class="highlighter-rouge">Hash</code> objects (&gt;=2.0), this method shouldn’t be here. This code forces every single instnace of <code class="highlighter-rouge">Hash</code> to be aware of this method called <code class="highlighter-rouge">trancsript_sort</code>, even if it hasn’t two ducks about this “transcript” object.</p>

<p><code class="highlighter-rouge"><span class="p">{</span><span class="err">x:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">y:</span><span class="w"> </span><span class="err">1</span><span class="p">}</span><span class="err">.transcript_sort</span></code>. Sure.</p>

<p>Oh, but it’s just one little simple method, what’s the harm?</p>

<p>The following is a real-world example from the same code base. No need to parse the method too closely, but you do get bonus points for appreciating how <code class="highlighter-rouge">prepare_interpolation</code> and <code class="highlighter-rouge">finalize_interpolation</code> are methods that were inserted into <code class="highlighter-rouge">String</code> for similarly specific purposes.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Hash</span>
  <span class="k">def</span> <span class="nf">split_words</span><span class="p">(</span><span class="n">paragraph_starts</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">no_break_up</span><span class="o">=</span><span class="kp">false</span><span class="p">,</span> <span class="n">max_word_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">new_words</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sorted_words</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nf">transcript_sort</span>
    <span class="n">add_blank</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="n">sorted_words</span><span class="p">.</span><span class="nf">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">word</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
      <span class="n">current_stamp</span> <span class="o">=</span> <span class="n">word</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">to_i</span>
      <span class="n">parts</span> <span class="o">=</span> <span class="n">word</span><span class="p">.</span><span class="nf">second</span><span class="p">.</span><span class="nf">prepare_interpolation</span><span class="p">(</span><span class="n">no_break_up</span><span class="p">,</span><span class="n">max_word_length</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
      <span class="n">parts</span> <span class="o">&lt;&lt;</span> <span class="s2">""</span> <span class="k">if</span> <span class="n">parts</span><span class="p">.</span><span class="nf">empty?</span>
      <span class="n">next_stamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">sorted_words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nf">try</span><span class="p">(</span><span class="ss">:first</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">current_stamp</span> <span class="o">+</span> <span class="n">parts</span><span class="p">.</span><span class="nf">length</span> <span class="o">*</span> <span class="mi">300</span><span class="p">)).</span><span class="nf">to_i</span>
      <span class="k">if</span> <span class="n">parts</span><span class="p">.</span><span class="nf">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">parts</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">blank?</span>
        <span class="n">new_words</span><span class="p">[</span><span class="n">current_stamp</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span> <span class="k">if</span> <span class="o">!!</span><span class="p">(</span><span class="n">add_blank</span> <span class="o">||</span> <span class="n">paragraph_starts</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">current_stamp</span><span class="p">))</span>
        <span class="n">add_blank</span> <span class="o">=</span> <span class="kp">false</span>
      <span class="k">else</span>
        <span class="n">increment</span> <span class="o">=</span> <span class="p">((</span><span class="n">next_stamp</span> <span class="o">-</span> <span class="n">current_stamp</span><span class="p">)</span> <span class="o">/</span> <span class="n">parts</span><span class="p">.</span><span class="nf">length</span><span class="p">).</span><span class="nf">floor</span>
        <span class="k">for</span> <span class="n">part</span> <span class="k">in</span> <span class="n">parts</span>
          <span class="n">new_words</span><span class="p">[</span><span class="n">current_stamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">part</span><span class="p">.</span><span class="nf">finalize_interpolation</span>
          <span class="n">current_stamp</span> <span class="o">=</span> <span class="n">current_stamp</span> <span class="o">+</span> <span class="n">increment</span>
        <span class="k">end</span>
        <span class="n">add_blank</span> <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="n">parts</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">editorial_note?</span> <span class="n">or</span> <span class="n">parts</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">end_of_sentence?</span><span class="p">(</span><span class="n">sorted_words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nf">try</span><span class="p">(</span><span class="ss">:second</span><span class="p">)))</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">new_words</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>###So what’s the skinny on this fat model?</p>

<p><code class="highlighter-rouge">transcript_sort</code> and these associated method apply only to a specific data object: the transcript as described above. It’s not only confusing to other devs (especially new ones exploring objects new to them) to insert such methods into core Ruby classes, it’s memory bloat and it’s just begging for name conflicts. Import some code that also modifies <code class="highlighter-rouge">Hash</code>? Here’s hoping they didn’t choose any of the same method names as you. May the odds be ever in your favor. It’s mixing concerns, it’s not good for unit testing, and shoving various concerns’ code into other classes increases the amount of code another developer needs to parse through to understand something completely unrelated to the task at hand.</p>

<p>The first thing I did to this code when I had a chance was to create a <code class="highlighter-rouge">Transcript</code> class that contained all the logic related to this transcript object. This class still stores the same data as the <code class="highlighter-rouge">Hash</code> version, but rather than assimilating <code class="highlighter-rouge">Hash</code>, it simply uses one as a data member. Ideally, we could have a <code class="highlighter-rouge">sort_words</code> method here that returned another <code class="highlighter-rouge">Transcript</code> object with the words sorted (or <code class="highlighter-rouge">sort_words!</code> for in-place). However, for compatiblilty with more code than I could change in one sitting, I created a <code class="highlighter-rouge">Transcript#sorted_words</code> method that returned the same array of [timestamp, words], sorted by timestamp.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Transcript</span>
  <span class="k">def</span> <span class="nf">sorted_words</span>
    <span class="vi">@words</span><span class="p">.</span><span class="nf">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">time</span><span class="p">,</span> <span class="n">word</span><span class="o">|</span> <span class="n">time</span><span class="p">.</span><span class="nf">to_i</span><span class="p">}</span>
  <span class="k">end</span>


  <span class="c1"># NIY in real life, but more ideal:</span>
  <span class="k">def</span> <span class="nf">sort_words</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">deep_dup</span><span class="p">.</span><span class="nf">sort_words!</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sort_words!</span>
    <span class="vi">@words</span><span class="p">.</span><span class="nf">sort_by!</span><span class="p">{</span><span class="o">|</span><span class="n">time</span><span class="p">,</span> <span class="n">word</span><span class="o">|</span> <span class="n">time</span><span class="p">.</span><span class="nf">to_i</span><span class="p">}</span>
    <span class="k">return</span> <span class="nb">self</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>###Over-objectification</p>

<p>The concern-mixing, namespace-conflicting, method-fixing style of coding is a common anti-pattern I have begun to observe. It often comes from new developers or developer new to object-oriented programming or more comfortable with more purely <a href="https://en.wikipedia.org/wiki/Functional_programming">functional programming</a>. Loathe though I am to admit it, this usage seems almost encouraged by the structure of Ruby in its beautfully stubborn insistance that, no, really, <em>everything</em> is an object. There seems encouragement that <code class="highlighter-rouge">object.do_something</code> is the One True Way to do anything at all to <code class="highlighter-rouge">object</code>. Ruby’s own terminology considers calling a method on an object “passing a message to it”. While there are some great advantages to this way of interpreting code, it’s not hard to see that, misapplied, it can confuse the concept of a well-organized class to a new developer. You get <code class="highlighter-rouge">MyModel#compute_complicated_stuff</code> instead of <code class="highlighter-rouge">ComplicatedStuffComputer.new(my_model).compute</code>. You get <code class="highlighter-rouge">Hash#split_words</code> instead of <code class="highlighter-rouge">Transcript#split_words</code>.</p>

<p>It’s not just new developers that are affected. Rails is one of the largest offenders. Just take a peek at how many Ruby core classes are overridden within the Rails framework. You can debate how convenient it is, how the benefits outweight the costs, or just that you think it was for any reason the right call for Rails. I still hold that it encourages over-objectification in developers learning on Rails.</p>

<p>The Rails scaffolding itself leaves many people believeing that the types of classes you make are ActiveRecord-backed models in app/models, and miscelaneous other utilities in the “lib” junk-drawer (there’s a <a href="http://blog.codeclimate.com/blog/2012/02/07/what-code-goes-in-the-lib-directory/">better way</a>). If you’ve worked in Rails, you’ve probably heard “fat model, skinny controller”, which all but encourages dumping all sorts of methods into ActiveRecord models. There’s a <a href="https://robots.thoughtbot.com/skinny-controllers-skinny-models">better way</a>.</p>

<p>Virtually all gems in popular use by Rails projects have this pattern of injecting their own methods into ActiveRecord::Base or something similar. It’s usually kept to a minimum, just defining the method that “enables” the gem for a given model. E.g., <a href="https://github.com/mbleigh/acts-as-taggable-on">acts-as-taggable-on</a> defines the methods <code class="highlighter-rouge">acts_as_taggable</code> and <code class="highlighter-rouge">acts_as_tagger</code> on ActiveRecord::Base. <a href="https://github.com/state-machines/state_machines">state-machines</a> defines <code class="highlighter-rouge">state_machine</code>. By itself, that’s fine: you accept when you install a gem that you’re configuring your environment, often ActiveRecord specifically, to work a certain way. But this contributes to why I think a lot of the existing framework out there encourages the anti-pattern of over-objectification.</p>

<h3 id="classification">Classification</h3>

<p>It is possible to beat this.</p>

<p>As mentioned above, the easy fix to the transcript methods scattered throughout <code class="highlighter-rouge">Hash</code>, <code class="highlighter-rouge">Array</code>, and <code class="highlighter-rouge">String</code> was to create an isolatable <code class="highlighter-rouge">Transcript</code> class that contained all of its own logic. This class then allows us to add new features to the <code class="highlighter-rouge">Transcript</code> class without all the clutter or scatter, and keeps the domain simple and intuitive. You can build utility methods that require a <code class="highlighter-rouge">Transcript</code> object and know exactly how to interact with its public methods. For example, a format converter that parses a <code class="highlighter-rouge">Transcript</code> and turns it into closed caption frames. This makes it obvious how to invoke this converted, rather than having to study how to morph your words into the exact specification implicitly documented by usage of transcript-hashes. This is what object oriented programming is about.</p>

<p>Expliring this style of code organization and conceptualization can bring about the best in what any object-oriented language has to offer. In Ruby, and especially Rails, we just have to try a little harder to encourage it.</p>

<p>Here’s some great further reading on motivations and methods for factoring out cluttered code into more isolated models, specifically geared toward Rails projects:</p>

<ul>
  <li><a href="https://robots.thoughtbot.com/skinny-controllers-skinny-models">Skinny controllers, skinny models</a></li>
  <li><a href="https://blog.engineyard.com/2014/keeping-your-rails-controllers-dry-with-services">Keeping your Rails controllers DRY with services</a></li>
  <li><a href="http://blog.steveklabnik.com/posts/2011-09-06-the-secret-to-rails-oo-design">The secret to Rails OO design</a></li>
  <li><a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">7 ways to decompose fat ActiveRecord models</a>.</li>
</ul>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Speak Softly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Speak Softly
            
            </li>
            
            <li><a href="mailto:ozydingo@gmail.com">ozydingo@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ozydingo"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">ozydingo</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/ozydingo"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">ozydingo</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A blog about coding awesome, powerful tools...respectfully
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
